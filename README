The code is stolen from the totem's plugin.
